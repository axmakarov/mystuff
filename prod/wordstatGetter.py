import requests
import json
import time

phrasesData = []
Phrases = ['Абразивоструйное оборудование','Авиакомпании','Авиационные клубы','Автозапчасти для иномарок','Автозапчасти для легковых автомобилей','Автозапчасти для отечественных автомобилей','Автоматизация бизнес-процессов','Автоматизация медицинских учреждений','Автоматизация предприятий общественного питания','Автоматизация производственных процессов','Автоматизация торговли','Автомобилестроение','Автостоянки','Агентирование морских судов','Агентства недвижимости','Агентства по подписке печатных изданий','Агентства по трудоустройству за рубежом','Академии','Акватеррариум','Аксессуары для ванных комнат','Актёрские агентства','Алкогольные напитки','Антикафе','Антикоррозийная обработка металлоконструкций','Аппаратная замена масла','Аптеки','Арбитражный управляющий','Аренда беседок','Аромамаркетинг','Архитектурно-строительное проектирование','Асбестотехническая продукция','Ателье обувные','Ателье трикотажные','Аттестация рабочих мест','Аэрография на транспорте','Аэродинамические комплексы','Бары','Безалкогольные напитки','Библиотеки','Бизнес-инкубаторы','Бильярдные залы','Биометрические тестирования','Благотворительные фонды','Благоустройство улиц','Блистерная упаковка','Ботанический сад','Боулинг','Бронированные автомобили','Бумага для полиграфии','Бункеровка судов','Бухгалтерские программы','Бэби-боксы','Бюро медико-социальной экспертизы','Бюро ремонта городских АТС','Валяльно-войлочные изделия','Ведение дел в судах','Ведение реестра владельцев ценных бумаг','Велнес-залы','Верёвочные парки','Ветеринарные лаборатории','Взрывные работы','Видеостудии','Военная комендатура','Военные комиссариаты','Врачебные амбулатории','Вторичные строительные материалы','Выездная техническая помощь на дороге','Газовое оборудование','Газовое оборудование для автотранспорта','Геологоразведочные работы','Геофизические работы','Гидрогеологические работы','Гидротехническое строительство','Гипермаркеты','Голографическая продукция','Гольф-клубы','Горно-шахтное оборудование','Городские автогрузоперевозки','Гостевые дома','Гостиницы для животных','Графитированное производство','Девелоперские услуги','Дезинфицирующие средства','Деколирование','Дельфинарий','Дендрарий','Деревообработка','Деревянная тара','Детейлинг','Детекторы лжи','Детские лагеря','Детские музыкальные школы','Детские художественные школы','Диабетологические центры','Диализные центры','Дизайн аквариумов','Дизайн одежды','Дизайн рекламы','Дизайнерские курсы','Добыча природного сырья','Древесный уголь','Железнодорожные вокзалы и станции','Женские консультации','Животноводство','Жилищное строительство','Жилищно-коммунальные услуги','Журналы','Заказ легкового транспорта по перевозке животных','Заказ пассажирского авиатранспорта','Занятия лечебной физкультурой','Занятия по аквааэробике','Запчасти для общественного транспорта','Запчасти для спецтехники','Запчасти для судов','Запчасти к сельхозтехнике','Защита авторских прав','Защитные кейсы','Звукоизоляционные работы','Земляные работы','Зернопереработка','Зооателье','Зооботанический сад','Зоопарк','Зуботехнические лаборатории','Избирательные комиссии','Изготовление бизнес-сувениров','Изготовление лекарственных препаратов на заказ','Иконописные мастерские','Инвестиционные компании','Инженерные службы','Инжиниринговые услуги','Информационная безопасность','Информационные агентства','Казино','Кальянные','Караоке-залы','Картографическая продукция','Кафе','Киноаттракционы','Кинооборудование – аренда, продажа','Кинопрокатные компании','Киностудии','Киношколы','Коворкинг','Колбасные изделия','Комбинаты питания','Комиссионные магазины','Коммутационное оборудование','Комплектующие для окон','Компьютерные клубы','Компьютерные курсы','Консерватории','Консервированная продукция','Конструкторские бюро','Контейнеры для грузоперевозок','Контрактная разработка электронных устройств','Контрактные автозапчасти','Контрольные браслеты','Концертные залы','Косметические услуги','Красящие вещества','Кредитные агентства','Кровельные материалы','Крюинговые агентства','Кузовной ремонт','Кулинария','Кулинарные курсы','Культурно-досуговые центры для взрослых','Курсы диджеев','Лабораторные реактивы','Лакокрасочные материалы','Лекарственные препараты','Лингафонное оборудование','Литейное производство','Магазины разливного пива','Магниты','Макаронные изделия','Малярный инструмент','Материалы для дорожного строительства','Материалы для железнодорожных путей','Материалы для наружной рекламы','Мебель для культурно-досуговых учреждений','Мебель для кухни','Мебель для медицинских учреждений и лабораторий','Мебель мягкая','Мебельные ткани','Медико-санитарные части','Медицинские расходные материалы','Медресе','Межшкольные учебные комбинаты','Мелкофасованные продукты питания','Металлоизделия','Металлообработка','Металлорежущий инструмент','Миграционные услуги','Модернизация компьютеров','Молочные продукты','Монтаж климатических систем','Монтаж компьютерных сетей','Монтаж охранно-пожарных систем','Мороженое','Научно-исследовательские институты','Научно-развлекательные центры','Независимая инвентаризация','Независимые службы аварийных комиссаров','Нерпинарий','Нетканые материалы','Нефтегазовое оборудование','Новостройки','Ногтевые студии','Ножи','Нотариальные палаты','Ночные клубы','Облицовочные материалы для мебели','Оболочка для колбасных изделий','Оборудование для автоматизации промышленных предприятий','Оборудование для автошкол','Оборудование для АЗС и нефтебаз','Оборудование для нанесения полимерных покрытий','Оборудование для пищевого производства','Оборудование для производства металла','Оборудование для производства окон','Оборудование для производства строительных материалов','Оборудование для рыбной промышленности','Оборудование для сельского хозяйства','Оборудование для утилизации отходов','Оборудование для фотоцентров','Оборудование для целлюлозно-бумажной промышленности','Оборудование для энергосбережения','Оборудование радиационного контроля','Обсерватории','Обслуживание выгребных ям','Обучение бизнес-профессиям','Обучение имидж-консультантов','Обучение массажистов','Обучение морским профессиям','Обучение по промышленной безопасности','Обучение рабочим профессиям','Обучение сотрудников охраны','Обучение судовождению','Обучение фитнес-инструкторов','Огнезащитные материалы','Океанариум','Окрасочное оборудование','Операторы сотовой связи','Опоры линий электропередач','Оптовая продажа сим-карт','Организации по профориентации','Организация активных туров','Организация внешнеэкономической деятельности','Организация выставок','Организация и проведение промоушн-акций','Организация экскурсий по городу','Ортопедия и травматология','Отделения общей врачебной практики','Отделения электросвязи','Отделочные материалы','Отделы ветеринарно-санитарного контроля','Оформление купли-продажи автомобилей','Очищение организма','Парикмахерские','Парк бабочек','Парки культуры и отдыха','Пейджинговые компании','Пенсионные фонды','Перегон автотранспорта','Пиво - опт','Питомники растений','Планетарий','Пластиковая мебель','Платёжные системы интернета','Платёжные терминалы','Пляжи','Пневмоинструмент','Погонажные изделия','Подводно-технические работы','Пожарная охрана','Поликлиники детские','Политические организации','Помощь в обучении','Помощь в оформлении ипотеки','Помощь в регистрации лекарственных средств','Порошковые краски','Почтообрабатывающее оборудование','Правовые программы','Предпечатная подготовка','Приюты для животных','Продажа автобусов','Продажа живых бабочек','Продажа лотерейных билетов','Продажа пищевого льда','Продажа программного обеспечения','Продовольственные магазины','Продукты быстрого приготовления','Проектирование инженерных систем','Производство автокомплектующих','Производство изделий из пластмасс','Производство обуви','Промышленное строительство','Промышленный дизайн','Противопожарные конструкции','Профессиональная химия','Профессиональные лицеи','Профессиональные спортивные клубы','Процессинговые центры','Психиатрические учреждения','Психолого-медико-педагогические комиссии','Пуховые изделия','Радиационный контроль','Радиостанции','Радиоэлектронные приборы','Размещение наружной рекламы','Размещение рекламы в интернете','Разработка компьютерных игр','Разработка программного обеспечения для мобильных устройств','Расходные материалы для полиграфии','Реабилитационные центры','Регистрация ценных бумаг','Рейтинговые агентства','Рекламные агентства полного цикла','Реконструкция и капремонт зданий','Рекрутинговые агентства','Ремонт автоэлектрики','Ремонт АКПП','Ремонт бензиновых двигателей','Ремонт бензоинструмента','Ремонт детских товаров','Ремонт дизельных двигателей','Ремонт климатического оборудования','Ремонт очков','Ремонт промышленного оборудования','Ремонт спецтехники','Ремонт торгового оборудования','Ремонт ходовой части автомобиля','Ремонт электродвигателей','Ремонт электроинструмента','Ремонт электронных систем управления автомобиля','Репетиционные студии','Реставрация памятников истории и культуры','Реставрация печатной продукции','Ресторанный консалтинг','Рестораны','Ритуальные услуги для животных','Родильные дома','Роллердромы','Рынки','Садоводческие товарищества','Сайты объявлений','Санитарно-эпидемиологический надзор','Сварочные работы','Секонд-хенд','Сервисное обслуживание бассейнов, фонтанов','Сервисное обслуживание нефтегазодобывающих компаний','Серийное производство мебели','Системы денежных переводов','Системы центрального пылеудаления','Скалодромы','Скорая медицинская помощь','Следственный комитет','Службы занятости населения','Службы знакомств','Снэковая продукция','Создание субтитров','Соляные комнаты','Сорбенты','Спасательное оборудование','Специализированное автооборудование','Спортивно-интеллектуальные клубы','Спортивно-тактические клубы','Спортивно-технические клубы','Спортивные школы','Спутниковая связь','Средства гигиены','Средства защиты от вредителей','Станции переливания крови','Стекломагнезитовые листы','Стеклянная тара','Стивидорные услуги','Стоматологические поликлиники','Стрелковые клубы','Строительство административных зданий','Строительство гаражей','Строительство сооружений сельскохозяйственного назначения','Студии загара','Сувениры','Супермаркеты','Сыры','Сырьё для лекарственных средств','Сырьё для пищевой промышленности','Сюрвейерские услуги','Таксидермические студии','Тампопечать','Теплоизоляционные работы','Территориальные общественные самоуправления','Технический осмотр транспорта','Техобслуживание теплоэнергосетей','Тиражирование дисков','Ткацкое оборудование','Товары для аэрографии','Товары для конного спорта','Товары для пчеловодства','Товары для фокусов','Тонизирующие салоны','Топливные карты','Трикотажные изделия','Тюнинг','Укрывной материал','Укупорочные изделия','Унты','Управленческий консалтинг','Услуга распиловки','Услуги ведения беременности','Услуги визажиста','Услуги водителя без автомобиля','Услуги врача-гомеопата','Услуги гематолога','Услуги генетика','Услуги дерматовенеролога','Услуги имидж-консультанта','Услуги инкассации','Услуги инфекциониста','Услуги кардиолога','Услуги логопеда','Услуги массажиста','Услуги нефролога','Услуги онколога','Услуги по отогреву автомобиля','Услуги по упаковке подарков','Услуги праздничного оформления','Услуги продюсирования','Услуги психотерапевта','Услуги пульмонолога','Услуги росписи по телу','Услуги сексолога','Услуги сомнолога','Услуги сурдопереводчиков','Услуги терапевта','Услуги факторинга','Услуги физиотерапевта','Услуги фтизиатра','Услуги хирурга','Услуги эндокринолога','Учебная литература','Фастфудная продукция - опт','Фельдшерско-акушерские пункты','Фильтр-прессы','Финансовый консалтинг','Фитопродукция','Фонд обязательного медицинского страхования','Фонды социального страхования','Фото на документы','Фотобанки','Фрахтование морских судов','Хлебобулочные изделия','Хранение меховых изделий','Центры альтернативной медицины','Центры борьбы со СПИДом','Центры генеалогии','Центры иммунизации','Центры квотирования рабочих мест','Центры повышения водительского мастерства','Центры трансплантации волос','Чайные клубы','Шипчандлерские услуги','Широкоформатная печать','Школы для будущих мам','Школы искусств','Школы каскадёров','Эзотерические товары','Экспедирование грузов','Экспертиза авиационных происшествий','Экспертиза лекарственных средств','Экспертиза промышленной безопасности','Электрические транспортные средства','Электроизмерительные работы','Электроизоляционные материалы','Электромонтажные работы','Электронные компоненты','Электронные табло','Электротехническая продукция','Элементы питания','Ювелирные камни','Юридическое обслуживание','Яйцо','Яхт-клубы']
# Phrases = ['Абразивоструйное оборудование','Авиакомпании','Авиационные клубы','Автозапчасти для иномарок','Автозапчасти для легковых автомобилей','Автозапчасти для отечественных автомобилей','Автоматизация бизнес-процессов','Автоматизация медицинских учреждений','Автоматизация предприятий общественного питания','Автоматизация производственных процессов','Автоматизация торговли','Автомобилестроение','Автостоянки','Агентирование морских судов','Агентства недвижимости','Агентства по подписке печатных изданий','Агентства по трудоустройству за рубежом','Академии','Акватеррариум','Аксессуары для ванных комнат','Актёрские агентства','Алкогольные напитки','Антикафе']

def GetToken(login,serviceType):
    if serviceType not in ['Metrika','Direct']:
        print 'Invalid service type'
        return None
    url = 'http://192.168.10.37:35678/TokenManagerService'
    payload = {'method':'GetToken','params':{'login':login.replace('@yandex.ru',''),'serviceType':serviceType}}
    r = requests.post(url,json.dumps(payload))
    data = json.loads(r.text)
    if len(data.keys()) == 1:
        print 'Invalid login'
        return None
    return data['result']['token']

TOKEN = GetToken('alexgrtula','Direct')
Phrases = [unicode(phrase.decode('utf-8')) for phrase in Phrases]
PhrasesLists = [Phrases[i:i+10] for i in xrange(0,len(Phrases),10)]
count = len(PhrasesLists)
i = 1
for PhrasesList in PhrasesLists:
    try:
        print '{0} phrases list in {1}'.format(i,count)
        payload = {"method": "CreateNewWordstatReport","token": TOKEN,"param": {"Phrases": PhrasesList,"GeoID": [1]}}
        jdata = json.dumps(payload, ensure_ascii=False).encode('utf8')
        r = requests.post(url,jdata)
        reportId = json.loads(r.text)['data']
        print 'create wordstat report {0}'.format(reportId)
        time.sleep(10)
        payload = {"method": "GetWordstatReport","token": TOKEN,"param": reportId}
        jdata = json.dumps(payload, ensure_ascii=False).encode('utf8')
        r = requests.post(url,jdata)
        data = json.loads(r.text)['data']
        print 'get wordstat report {0}'.format(reportId)
        for item in data:
            inputPhrase = item['Phrase']
            phraseType = 'SearchedAlso'
            try:
                for phrase in item['SearchedAlso']:
                    wordstatPhrase = phrase['Phrase']
                    wordstatCount = phrase['Shows']
                    phrasesData.append({'inputPhrase':inputPhrase,'phraseType':phraseType,'wordstatPhrase':wordstatPhrase,'wordstatCount':wordstatCount})
            except:
                pass
            phraseType = 'SearchedWith'
            try:
                for phrase in item['SearchedWith']:
                    wordstatPhrase = phrase['Phrase']
                    wordstatCount = phrase['Shows']
                    phrasesData.append({'inputPhrase':inputPhrase,'phraseType':phraseType,'wordstatPhrase':wordstatPhrase,'wordstatCount':wordstatCount})
            except:
                pass
        print 'add report data to summary data'
        payload = {"method": "DeleteWordstatReport","token": TOKEN,"param": reportId}
        jdata = json.dumps(payload, ensure_ascii=False).encode('utf8')
        r = requests.post(url,jdata)
        print r.text
        print 'report {0} deleted'.format(reportId)
        time.sleep(5)
    except:
        continue
    i += 1
